<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
        <title>延时加载测试</title>
        <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
        <style>
            * {
                padding: 0;
                margin: 0;
            }
            
        </style>
        
	</head>
	<body>
		<div class="timers" id="timers">
            <div class="timer1">{{dataStr}}</div>
        </div>
    <script type="text/javascript">
    var vm = new Vue({
        el: '#timers',
        data: {
            timerObj: {},
            dataStr: ''
        },
        mounted: function () {
            this.setTime('2021-02-19 18:31', 1)
        },
        methods: {
            setTime: function(timestr, index){
                var self = this
                var leftTime = new Date(timestr.replace(/\-/g, '/')).getTime() - new Date().getTime();
                this.timerObj[index] = setInterval(function () {
                    if (leftTime >= 0) {
                        var d = self.formatNumber(Math.floor(leftTime / 1000 / 60 / 60 / 24));
                        var h = self.formatNumber(Math.floor(leftTime / 1000 / 60 / 60 % 24));
                        var m = self.formatNumber(Math.floor(leftTime / 1000 / 60 % 60));
                        var s = self.formatNumber(Math.floor(leftTime / 1000 % 60));
                        leftTime--
                        console.log(leftTime,d,h,m,s)
                        self.dataStr = d + '天' + h + ':' + m + ':' + s
                    } else {
                        clearInterval(self.timerObj[index]);
                        self.dataStr = '拼团已结束';
                    }
                }, 1000)
            },
            formatNumber: function (n) {
                n = n.toString();
                return n[1] ? n : '0' + n;
            }
        }
    })
	</script>
	</body>
</html>

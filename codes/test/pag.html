<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
        <title>延时加载测试</title>
        <script src="https://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
        <style>
            * {
                padding: 0;
                margin: 0;
            }
            html, body {
                height: 100%;
            }
            #pag {
                background-color: dimgrey;
                width: 100%;
                height: 100%;
            }
        </style>
        
	</head>
	<body>
		<div id="clickBtn" onclcik="startAni()">按钮</div>
        <canvas class="canvas" id="pag"></canvas>
        <script src="../js/libpag.min.js"></script>
        <!-- <script src="../js/libpag.wasm"></script> -->
        <!-- <script src="https://cdn.jsdelivr.net/npm/libpag@latest/lib/libpag.min.js"></script> -->
        
        <script>

        //   window.onload = async () => {
        //     // 实例化 PAG
        //     const PAG = await window.libpag.PAGInit();
        //     // 获取 PAG 素材数据
        //     const buffer = await fetch('../images/1.pag').then((response) => response.arrayBuffer());
        //     // 加载 PAG 素材为 PAGFile 对象
        //     const pagFile = await PAG.PAGFile.load(buffer);
        //     // 将画布尺寸设置为 PAGFile的尺寸
        //     const canvas = document.getElementById('pag');
        //     canvas.width = pagFile.width();
        //     canvas.height = pagFile.height();
        //     // 实例化 PAGView 对象
        //     const pagView = await PAG.PAGView.init(pagFile, canvas);
        //     // 播放 PAGView
        //     await pagView.play();
        //   };
        //   window.onload = function () {
        //       $.ajax({
        //           url: '../images/1.pag',
        //           type: 'get',
        //           dataType: 'json',
        //           data: {},
        //           success: function (res) {
        //             console.log(res.arrayBuffer(), '-----------')
        //           }
        //       })
        //   }
        // var self = this
        var startAni
        window.onload = function () {
            libpag.PAGInit().then((pag) => {
                // 实例化成功
                console.log('pag', pag)
                var xhr = new XMLHttpRequest();
                xhr.withCredentials = true
                xhr.open('get', '../images/1.pag');
                xhr.responseType = 'arraybuffer'; // 返回类型blob
                xhr.onload = function() {
                    console.log('this', this.response)
                    var pagFile = pag.PAGFile.load(this.response).then(function (fileType) {
                        console.log(fileType, 'fileType', fileType.width(), fileType.height())
                        var canvas = document.getElementById('pag')
                        var pagView = pag.PAGView.init(fileType, canvas).then(function (viewPro) {
                            console.log('viewPro', viewPro)
                            startAni = function () {
                                console.log('click')
                                viewPro.play()
                            }
                            document.getElementById('clickBtn').addEventListener('click',startAni, true)
                            
                        })
                        console.log('pagView', pagView)
                    })
                    console.log(pagFile, 'pagFile')
                }
                xhr.send(); // 发送ajax请求
            })
        }
        
 
            
        </script>
	</body>
</html>

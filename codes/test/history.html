<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>历史记录</title>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <style>
        * {
            padding: 0;
            margin: 0;
        }
    </style>

</head>

<body>
    <div id="history">
        <div @click="toNext(1)">pushState</div>
        <div @click="toNext(2)">replaceState</div>
    </div>
    <script src="../js/vconsole.min.js"></script>
    <script type="text/javascript">
        window.addEventListener("pageshow", function(event) {
            console.log("PageShow Event  " + event.persisted);
            console.log(event);
            if (event.persisted) {
                // window.location.reload();
            }
        });
        var vConsole = new VConsole();
        var vm = new Vue({
            el: '#history',
            data: {

            },
            mounted: function () {

            },
            methods: {
                getUrlParam: function (param, value) {
                    // 取链接上参数
                    var s = location.search
                    var arr = []
                    // 参数转成数组
                    if (s != '') {
                        s = s.substr(1)
                        arr = s.split('&')
                    }
                    // 数组转成对象
                    var obj = {}
                    for (var i=0; i<arr.length; i++) {
                        obj[arr[i].split('=')[0]] = arr[i].split('=')[1]
                    }
                    // 对象里有属性，替换属性的值
                    // 对象里没有属性，增加属性
                    // if (obj.hasOwnProperty(param)) {
                    //     obj[param] = value
                    // } else {
                    //     obj[param] = value
                    // }
                    // 可以合并成一步
                    obj[param] = value
                    // 拼接成链接参数
                    var str = ''
                    for (var key in obj) {
                        str += (str.indexOf('?') == -1 ? '?' : '&') + (key + '=' + obj[key])
                    }
                    return str
                },
                toNext: function (num) {
                    var url = location.origin + location.pathname
                    if (num == 1) {
                        url += url.indexOf('?') > -1 ? '&page=1' : '?page=1'
                        // 增加历史记录
                        history.pushState(null,'',url)
                    } else {
                        url += this.getUrlParam('index', 1)
                        // 改变页面url
                        // history.replaceState(null,'',url)
                        location.href = 'index.html'
                    }
                },
            }
        })
    </script>
</body>

</html>